/*
 * multifile-upload v1.0 (https://www.impactmedianc.com/)
 * Copyright Impact Media 2016 Drew Denstedt
 */
var MultiFile=function(a){this.debug=!1,this.form_id=a,this.upload_url="",this.redirect_url="",this.files=[],this.form=document.getElementById(a),null!==this.form?this.upload_url=this.form.action:this.errorMessage("form"),this.inputListener(),this.outputListener(),this.formListener()};MultiFile.prototype.setDebug=function(a){this.debug=a},MultiFile.prototype.setUploadUrl=function(a){this.upload_url=a},MultiFile.prototype.setRedirectUrl=function(a){this.redirect_url=a},MultiFile.prototype.setInput=function(a){var b=document.getElementById(a);null!==b?this.files[a]=[]:this.errorMessage("input")},MultiFile.prototype.compareFiles=function(a){if(this.files[a.id].length>0){if(a.files.length>0)for(var b in a.files){var c=!0;for(var d in this.files[a.id])(a.files[b]==this.files[a.id][d]||"length"==b)&&(c=!1);if(c){var e=this.files[a.id].length;this.files[a.id][e]=a.files[b],this.files[a.id].length=e+1}}}else if(a.files.length>0)for(var b in a.files)this.files[a.id][b]=a.files[b];this.updateOutput(a)},MultiFile.prototype.updateOutput=function(a){var b=document.getElementById(a.id+"-output");if(null!==b&&b.parentNode.removeChild(b),a.parentNode.parentNode.getElementsByTagName("output")[0].textContent="",this.files[a.id].length>0){for(var c=document.createDocumentFragment(),d=0;d<this.files[a.id].length;d++){var e=document.createElement("div");e.classList.add("row","multifile-output");var f=document.createElement("span");f.className="col-xs-12",f.textContent=this.files[a.id][d].name;var g=document.createElement("span");g.classList.add("glyphicon","glyphicon-remove","multifile-remove"),g.dataset.multifile=d,g.dataset.multifile_id=a.id,f.appendChild(g),e.appendChild(f),c.appendChild(e)}a.parentNode.parentNode.getElementsByTagName("output")[0].appendChild(c)}else a.parentNode.parentNode.getElementsByTagName("output")[0].textContent="No Files Chosen"},MultiFile.prototype.inputListener=function(){var a=this;document.addEventListener("change",function(b){b.target&&b.target.classList.contains("multifile")&&a.compareFiles(document.getElementById(b.target.id))})},MultiFile.prototype.outputListener=function(){var a=this;document.addEventListener("mouseup",function(b){b.target&&b.target.classList.contains("multifile-remove")&&(a.files[b.target.dataset.multifile_id].splice([Number(b.target.dataset.multifile)],1),a.updateOutput(document.getElementById(b.target.dataset.multifile_id)))})},MultiFile.prototype.formListener=function(){var a=this;this.form.addEventListener("submit",function(b){b.preventDefault();var c=new FormData;for(var d in a.files)for(var e=0;e<a.files[d].length;e++)c.append(d+"[]",a.files[d][e]);var f=$("#"+a.form_id).serializeArray();$.each(f,function(a,b){c.append(b.name,b.value)}),$.ajax({url:a.upload_url,data:c,processData:!1,contentType:!1,type:"POST",success:function(b){a.debug?console.log(b):window.location.replace(a.redirect_url)},error:function(a,b){var c="";c=0===a.status?"Not connect.\n Verify Network.":404==a.status?"Requested page not found. [404]":500==a.status?"Internal Server Error [500].":"parsererror"===b?"Requested JSON parse failed.":"timeout"===b?"Time out error.":"abort"===b?"Ajax request aborted.":"Uncaught Error.\n"+a.responseText,console.log(c)}})})},MultiFile.prototype.errorMessage=function(a){switch(a){case"form":console.log("Invalid Form ID");break;case"input":console.log("Invalid Input ID");break;default:console.log("Unknown Error :/")}};